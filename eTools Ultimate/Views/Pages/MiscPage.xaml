<Page
    x:Class="eTools_Ultimate.Views.Pages.MiscPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:eTools_Ultimate.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:i18n="http://schemas.lepo.co/i18n/2022/xaml"
    xmlns:local="clr-namespace:eTools_Ultimate.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:pageViewModels="clr-namespace:eTools_Ultimate.ViewModels.Pages"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="MiscPage"
    d:DataContext="{d:DesignInstance pageViewModels:MiscViewModel,
                                     IsDesignTimeCreatable=False}"
    d:DesignHeight="900"
    d:DesignWidth="1400"
    ScrollViewer.CanContentScroll="False"
    mc:Ignorable="d">

    <Page.Resources>
        <!--  Converters  -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />
        <converters:IntToBoolConverter x:Key="IntToBoolConverter" />
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Banner  -->
        <Border
            Grid.Row="0"
            Height="200"
            Margin="0,0,0,24"
            CornerRadius="8"
            Cursor="Arrow">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Offset="0" Color="#2B5797" />
                    <GradientStop Offset="1" Color="#0078D7" />
                </LinearGradientBrush>
            </Border.Background>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!--  Content overlay  -->
                <StackPanel
                    Grid.Row="0"
                    Margin="48,0"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Center"
                    Background="Transparent">
                    <ui:TextBlock
                        FontSize="32"
                        FontTypography="Title"
                        FontWeight="Bold"
                        Foreground="White"
                        Text="{i18n:StringLocalizer 'Find Unused assets'}" />
                    <ui:TextBlock
                        Margin="0,8,0,0"
                        FontSize="16"
                        Foreground="#CCFFFFFF"
                        Text="{i18n:StringLocalizer 'Scan dependencies and list assets not referenced anywhere'}" />
                </StackPanel>

                <ui:TextBlock
                    Grid.Row="1"
                    Margin="12"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Bottom"
                    FontTypography="Caption"
                    Foreground="#57FFFFFF"
                    Text="{i18n:StringLocalizer 'Created by eTools Ultimate'}" />
            </Grid>
        </Border>

        <!--  Tool Section  -->
        <Grid Grid.Row="1" Margin="24,0,24,24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!--  Find Unused Models & Textures Tool  -->
            <ui:CardControl Grid.Row="0" Margin="0,0,0,16">
                <ui:CardControl.Header>
                    <StackPanel Margin="0,0,16,0">
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon
                                Margin="0,0,8,0"
                                Foreground="{Binding StatusColor}"
                                Symbol="{Binding StatusIcon}" />
                            <ui:TextBlock
                                FontSize="14"
                                FontWeight="Medium"
                                Text="{i18n:StringLocalizer 'Status'}" />
                        </StackPanel>
                        <ui:TextBlock
                            Margin="0,4,0,0"
                            Foreground="{Binding StatusColor}"
                            Text="{Binding ScanProgress}" />

                        <!--  Size Summary  -->
                        <StackPanel Margin="0,12,0,0" Orientation="Horizontal">
                            <ui:TextBlock
                                FontSize="14"
                                FontWeight="Medium"
                                Text="{i18n:StringLocalizer 'Total size'}" />
                            <ui:TextBlock
                                Margin="8,0,16,0"
                                FontSize="14"
                                Foreground="Gray"
                                Text="{Binding TotalSizeFormatted}" />
                            <ui:TextBlock
                                FontSize="14"
                                FontWeight="Medium"
                                Text="{i18n:StringLocalizer 'Selected'}" />
                            <ui:TextBlock
                                Margin="8,0,16,0"
                                FontSize="14"
                                Foreground="Gray"
                                Text="{Binding SelectedSizeFormatted}" />
                        </StackPanel>
                    </StackPanel>
                </ui:CardControl.Header>
                <ui:CardControl.Content>
                    <StackPanel Orientation="Horizontal">
                        <ui:Button
                            Margin="0,0,8,0"
                            Command="{Binding ScanForUnusedAssetsCommand}"
                            IsEnabled="{Binding IsScanning, Converter={StaticResource InverseBooleanConverter}}">
                            <StackPanel Orientation="Horizontal">
                                <ui:SymbolIcon
                                    Margin="0,0,8,0"
                                    FontSize="16"
                                    Symbol="Search24" />
                                <ui:TextBlock Text="{i18n:StringLocalizer 'Scan Assets'}" />
                            </StackPanel>
                        </ui:Button>


                        <ui:Button
                            Margin="0,0,8,0"
                            Command="{Binding DeleteSelectedAssetsCommand}"
                            IsEnabled="{Binding UnusedAssets.Count, Converter={StaticResource IntToBoolConverter}}">
                            <StackPanel Orientation="Horizontal">
                                <ui:SymbolIcon
                                    Margin="0,0,8,0"
                                    FontSize="16"
                                    Symbol="Delete24" />
                                <ui:TextBlock Text="{i18n:StringLocalizer 'Delete Selected'}" />
                            </StackPanel>
                        </ui:Button>

                        <ui:Button Margin="0,0,8,0" Command="{Binding ViewLogCommand}">
                            <StackPanel Orientation="Horizontal">
                                <ui:SymbolIcon
                                    Margin="0,0,8,0"
                                    FontSize="16"
                                    Symbol="Document24" />
                                <ui:TextBlock Text="{i18n:StringLocalizer 'View Log'}" />
                            </StackPanel>
                        </ui:Button>
                    </StackPanel>
                </ui:CardControl.Content>
            </ui:CardControl>

            <!--  Search and Filter  -->
            <Grid Grid.Row="1" Margin="0,0,0,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="265" />
                </Grid.ColumnDefinitions>

                <ui:TextBlock
                    Grid.Column="0"
                    VerticalAlignment="Center"
                    FontSize="14"
                    Foreground="Gray"
                    Text="{Binding UnusedAssets.Count, StringFormat='{}{0} assets found'}" />

                <ComboBox
                    Grid.Column="1"
                    Margin="12,0"
                    HorizontalAlignment="Left"
                    SelectedValue="{Binding SelectedAssetType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    SelectedValuePath="Tag">
                    <ComboBoxItem Content="{i18n:StringLocalizer 'All'}" Tag="{x:Null}" />
                    <ComboBoxItem Content="{i18n:StringLocalizer 'Models'}" Tag="{x:Static pageViewModels:AssetType.Model}" />
                    <ComboBoxItem Content="{i18n:StringLocalizer 'Animations'}" Tag="{x:Static pageViewModels:AssetType.Animation}" />
                    <ComboBoxItem Content="{i18n:StringLocalizer 'Model bones'}" Tag="{x:Static pageViewModels:AssetType.Bones}" />
                    <ComboBoxItem Content="{i18n:StringLocalizer 'Textures'}" Tag="{x:Static pageViewModels:AssetType.Texture}" />
                    <ComboBoxItem Content="{i18n:StringLocalizer 'Unknown'}" Tag="{x:Static pageViewModels:AssetType.Unknown}" />
                </ComboBox>


                <ui:TextBox
                    Grid.Column="2"
                    Width="265"
                    Margin="0"
                    HorizontalAlignment="Right"
                    PlaceholderText="{i18n:StringLocalizer 'Search by name, path, or type...'}"
                    Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}">
                    <ui:TextBox.Icon>
                        <ui:SymbolIcon Symbol="Search24" />
                    </ui:TextBox.Icon>
                </ui:TextBox>
            </Grid>
        </Grid>

        <!--  DataGrid  -->
        <Grid Grid.Row="2" Margin="24,0,24,24">
            <DataGrid
                HorizontalAlignment="Stretch"
                AutoGenerateColumns="False"
                CanUserAddRows="False"
                CanUserDeleteRows="False"
                CanUserReorderColumns="True"
                CanUserResizeColumns="True"
                CanUserSortColumns="True"
                GridLinesVisibility="Horizontal"
                HeadersVisibility="Column"
                ItemsSource="{Binding UnusedAssetsView}"
                SelectionMode="Extended">
                <DataGrid.Columns>
                    <!--  Selection Checkbox  -->
                    <DataGridTemplateColumn Width="60" CanUserSort="False">
                        <DataGridTemplateColumn.HeaderTemplate>
                            <DataTemplate>
                                <CheckBox HorizontalAlignment="Center" IsChecked="{Binding DataContext.IsEveryFileSelected, Mode=TwoWay, RelativeSource={RelativeSource AncestorType=Page}}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.HeaderTemplate>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <CheckBox HorizontalAlignment="Center" IsChecked="{Binding IsSelected, Mode=TwoWay}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!--  Asset Type  -->
                    <DataGridTextColumn
                        Width="100"
                        Binding="{Binding AssetType}"
                        Header="{i18n:StringLocalizer 'Type'}" />

                    <!--  File Name  -->
                    <DataGridTextColumn
                        Width="*"
                        MinWidth="200"
                        Binding="{Binding FileName}"
                        Header="{i18n:StringLocalizer 'File Name'}" />

                    <!--  File Path  -->
                    <DataGridTextColumn
                        Width="*"
                        MinWidth="300"
                        Binding="{Binding FilePath}"
                        Header="{i18n:StringLocalizer 'Path'}" />

                    <!--  File Size  -->
                    <DataGridTextColumn
                        Width="120"
                        Binding="{Binding FormattedFileSize}"
                        Header="{i18n:StringLocalizer 'Size'}"
                        SortMemberPath="FileSize" />

                    <!--  Last Modified  -->
                    <DataGridTextColumn
                        Width="150"
                        Binding="{Binding LastModified, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}"
                        Header="{i18n:StringLocalizer 'Last Modified'}"
                        SortMemberPath="LastModified" />

                    <!--  Actions  -->
                    <DataGridTemplateColumn Width="120" CanUserSort="False">
                        <DataGridTemplateColumn.Header>
                            <ui:TextBlock Text="{i18n:StringLocalizer 'Actions'}" />
                        </DataGridTemplateColumn.Header>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <ui:Button
                                        Margin="0,0,4,0"
                                        Command="{Binding DataContext.DeleteSingleAssetCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        CommandParameter="{Binding}">
                                        <ui:SymbolIcon FontSize="16" Symbol="Delete24" />
                                    </ui:Button>
                                    <ui:Button Command="{Binding DataContext.OpenInExplorerCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}" CommandParameter="{Binding}">
                                        <ui:SymbolIcon FontSize="16" Symbol="Folder24" />
                                    </ui:Button>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </Grid>
</Page>
